import{a as O}from"./chunk-I25RWIZD.js";import{$ as L,A as E,B as y,C as we,Ca as Pe,D as f,Da as $,E as ne,Ea as Me,F as k,G as A,Ha as ce,Ia as De,J as Se,Ja as Re,Ka as Le,L as D,La as je,M as R,Ma as xe,O as Ee,Oa as Fe,Pa as q,Q as Ce,Qa as N,Ra as Ue,S as oe,Sa as pe,Ta as Ve,U as u,V as _,a as ue,ba as d,c as U,ca as B,da as a,e as V,ea as c,f as H,fa as W,g as me,h as v,i as fe,ia as j,j as te,ja as T,ka as se,l as ie,la as Ie,m as re,ma as l,n as I,na as ye,o as b,oa as ke,p as de,q as he,r as w,ra as Ae,s as ge,sa as _e,t as ve,ta as Te,u as be,v as S,wa as Ne,x as M,xa as ae,ya as Oe}from"./chunk-W2PSN42I.js";var F="Service workers are disabled or not supported by this browser";function Ze(t){return te(()=>me(new Error(t)))}var P=class{constructor(e){if(this.serviceWorker=e,!e)this.worker=this.events=this.registration=Ze(F);else{let r=ie(e,"controllerchange").pipe(v(()=>e.controller)),n=te(()=>H(e.controller)),o=fe(n,r);this.worker=o.pipe(b(h=>!!h)),this.registration=this.worker.pipe(S(()=>e.getRegistration()));let g=ie(e,"message").pipe(v(h=>h.data)).pipe(b(h=>h&&h.type)).pipe(be());g.connect(),this.events=g}}postMessage(e,i){return this.worker.pipe(w(1),M(r=>{r.postMessage(ue({action:e},i))})).toPromise().then(()=>{})}postMessageWithOperation(e,i,r){let n=this.waitForOperationCompleted(r),o=this.postMessage(e,i);return Promise.all([o,n]).then(([,p])=>p)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(e){let i;return typeof e=="string"?i=r=>r.type===e:i=r=>e.includes(r.type),this.events.pipe(b(i))}nextEventOfType(e){return this.eventsOfType(e).pipe(w(1))}waitForOperationCompleted(e){return this.eventsOfType("OPERATION_COMPLETED").pipe(b(i=>i.nonce===e),w(1),v(i=>{if(i.result!==void 0)return i.result;throw new Error(i.error)})).toPromise()}get isEnabled(){return!!this.serviceWorker}},K=(()=>{let e=class e{get isEnabled(){return this.sw.isEnabled}constructor(r){if(this.sw=r,this.pushManager=null,this.subscriptionChanges=new U,!r.isEnabled){this.messages=I,this.notificationClicks=I,this.subscription=I;return}this.messages=this.sw.eventsOfType("PUSH").pipe(v(o=>o.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(v(o=>o.data)),this.pushManager=this.sw.registration.pipe(v(o=>o.pushManager));let n=this.pushManager.pipe(S(o=>o.getSubscription()));this.subscription=re(n,this.subscriptionChanges)}requestSubscription(r){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(F));let n={userVisibleOnly:!0},o=this.decodeBase64(r.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),p=new Uint8Array(new ArrayBuffer(o.length));for(let s=0;s<o.length;s++)p[s]=o.charCodeAt(s);return n.applicationServerKey=p,this.pushManager.pipe(S(s=>s.subscribe(n)),w(1)).toPromise().then(s=>(this.subscriptionChanges.next(s),s))}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(F));let r=n=>{if(n===null)throw new Error("Not subscribed to push notifications.");return n.unsubscribe().then(o=>{if(!o)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})};return this.subscription.pipe(w(1),S(r)).toPromise()}decodeBase64(r){return atob(r)}};e.\u0275fac=function(n){return new(n||e)(f(P))},e.\u0275prov=E({token:e,factory:e.\u0275fac});let t=e;return t})(),Z=(()=>{let e=class e{get isEnabled(){return this.sw.isEnabled}constructor(r){if(this.sw=r,!r.isEnabled){this.versionUpdates=I,this.unrecoverable=I;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(F));let r=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:r},r)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(F));let r=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:r},r)}};e.\u0275fac=function(n){return new(n||e)(f(P))},e.\u0275prov=E({token:e,factory:e.\u0275fac});let t=e;return t})();var He=new we("");function Ge(t,e,i,r){return()=>{if(!(ce(r)&&"serviceWorker"in navigator&&i.enabled!==!1))return;let n=t.get(Ce),o=t.get(ae);n.runOutsideAngular(()=>{let s=navigator.serviceWorker,m=()=>s.controller?.postMessage({action:"INITIALIZE"});s.addEventListener("controllerchange",m),o.onDestroy(()=>{s.removeEventListener("controllerchange",m)})});let p;if(typeof i.registrationStrategy=="function")p=i.registrationStrategy();else{let[s,...m]=(i.registrationStrategy||"registerWhenStable:30000").split(":");switch(s){case"registerImmediately":p=H(null);break;case"registerWithDelay":p=Be(+m[0]||0);break;case"registerWhenStable":let g=V(t.get(ae).whenStable());p=m[0]?re(g,Be(+m[0])):g;break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${i.registrationStrategy}`)}}n.runOutsideAngular(()=>p.pipe(w(1)).subscribe(()=>navigator.serviceWorker.register(e,{scope:i.scope}).catch(s=>console.error("Service worker registration failed with:",s))))}}function Be(t){return H(null).pipe(ge(t))}function Ye(t,e){return new P(ce(e)&&t.enabled!==!1?navigator.serviceWorker:void 0)}var x=class{};function ze(t,e={}){return Se([K,Z,{provide:He,useValue:t},{provide:x,useValue:e},{provide:P,useFactory:Ye,deps:[x,oe]},{provide:Ne,useFactory:Ge,deps:[Ee,He,x,oe],multi:!0}])}var We=(()=>{let e=class e{static register(r,n={}){return{ngModule:e,providers:[ze(r,n)]}}};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=A({type:e}),e.\u0275inj=y({providers:[K,Z]});let t=e;return t})();var Qe=t=>["/books",t];function Xe(t,e){if(t&1&&(a(0,"li")(1,"a",6),l(2),a(3,"p",7),l(4),c()()()),t&2){let i=e.$implicit;u(),d("routerLink",Ae(3,Qe,i.isbn)),u(),ke(" ",i.title," "),u(2),ye(i.subtitle)}}function et(t,e){t&1&&(a(0,"li"),l(1,"No results"),c())}function tt(t,e){if(t&1&&(a(0,"ul",3),L(1,Xe,5,5,"li",4)(2,et,2,0,"li",5),c()),t&2){let i=e.ngIf;u(),d("ngForOf",i),u(),d("ngIf",!i.length)}}var G=class t{constructor(e){this.service=e;this.results$=this.input$.pipe(b(i=>i.length>=3),he(500),ve(),M(()=>this.isLoading=!0),S(i=>this.service.getAllSearch(i)),M(()=>this.isLoading=!1))}input$=new U;isLoading=!1;results$;static \u0275fac=function(i){return new(i||t)(_(Ve))};static \u0275cmp=k({type:t,selectors:[["bm-search"]],decls:4,vars:5,consts:[["searchInput",""],["type","search","autocomplete","off","aria-label","Search",3,"input"],["class","search-results",4,"ngIf"],[1,"search-results"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"routerLink"],["role","doc-subtitle"]],template:function(i,r){if(i&1){let n=j();a(0,"input",1,0),T("input",function(){D(n);let p=Ie(1);return R(r.input$.next(p.value))}),c(),L(2,tt,3,2,"ul",2),_e(3,"async")}i&2&&(B("loading",r.isLoading),u(2),d("ngIf",Te(3,3,r.results$)))},dependencies:[Pe,$,N,Me]})};var Y=class t{static \u0275fac=function(i){return new(i||t)};static \u0275cmp=k({type:t,selectors:[["bm-home"]],decls:7,vars:0,consts:[["routerLink","/books",1,"button","red"]],template:function(i,r){i&1&&(a(0,"h1"),l(1,"Home"),c(),a(2,"a",0),l(3,` Show book list
`),c(),a(4,"h2"),l(5,"Search"),c(),W(6,"bm-search"))},dependencies:[N,G]})};var Ke=()=>{let t=ne(O),e=ne(q);return t.isAuthenticated?!0:(window.alert("Not logged in!"),e.parseUrl("/home"))};var rt=[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",component:Y},{path:"books",loadChildren:()=>import("./chunk-GROPWEZC.js").then(t=>t.BooksModule)},{path:"admin",loadChildren:()=>import("./chunk-75RAEIPC.js").then(t=>t.AdminModule),canActivate:[Ke]}],z=class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=A({type:t});static \u0275inj=y({imports:[pe.forRoot(rt),pe]})};var J=class t{constructor(e,i,r){this.http=e;this.swPush=i;this.router=r;this.swPush.notificationClicks.subscribe(n=>{let o=n.notification.data;o?.book?.isbn&&this.router.navigate(["/books",o.book.isbn])})}VAPID_PUBLIC_KEY="BGk2Rx3DEjXdRv9qP8aKrypFoNjISAZ54l-3V05xpPOV-5ZQJvVH9OB9Rz5Ug7H_qH6CEr40f4Pi3DpjzYLbfCA";baseUrl="https://api5.angular-buch.com/notifications";get isEnabled(){return this.swPush.isEnabled}requestSubscription(){let e=this.swPush.requestSubscription({serverPublicKey:this.VAPID_PUBLIC_KEY});return V(e).pipe(de(i=>this.registerOnServer(i)))}registerOnServer(e){return this.http.post(this.baseUrl,e)}static \u0275fac=function(i){return new(i||t)(f(De),f(K),f(q))};static \u0275prov=E({token:t,factory:t.\u0275fac,providedIn:"root"})};function st(t,e){if(t&1){let i=j();a(0,"button",7),T("click",function(){D(i);let n=se();return R(n.auth.login())}),l(1,"Login"),c()}}function at(t,e){if(t&1){let i=j();a(0,"button",8),T("click",function(){D(i);let n=se();return R(n.auth.logout())}),l(1,"Logout"),c()}}var Q=class t{constructor(e,i,r){this.auth=e;this.swUpdate=i;this.notificationService=r;this.swUpdate.versionUpdates.subscribe(n=>{switch(n.type){case"VERSION_DETECTED":{console.log("Downloading new app version:",n.version.appData);break}case"VERSION_READY":{let o=n.currentVersion.appData,p=n.latestVersion.appData,s=o.version,m=p.version,g=p.changelog,h=`Update from ${s} to ${m}. Changes: ${g}. Install?`;window.confirm(h)&&window.location.reload();break}case"VERSION_INSTALLATION_FAILED":{console.log(`Failed to install ${n.version.appData}:`,n.error);break}}}),this.notificationService.isEnabled&&this.setPermission()}permission;setPermission(){"Notification"in window&&(this.permission=Notification.permission)}requestSubscription(){this.notificationService.requestSubscription().subscribe(()=>this.setPermission())}static \u0275fac=function(i){return new(i||t)(_(O),_(Z),_(J))};static \u0275cmp=k({type:t,selectors:[["bm-root"]],decls:14,vars:7,consts:[["routerLink","/home","routerLinkActive","active","ariaCurrentWhenActive","page"],["routerLink","/books","routerLinkActive","active","ariaCurrentWhenActive","page"],["routerLink","/admin","routerLinkActive","active","ariaCurrentWhenActive","page"],[1,"actions"],["class","green",3,"click",4,"ngIf"],["class","red",3,"click",4,"ngIf"],["aria-label","Notifications",3,"click","disabled"],[1,"green",3,"click"],[1,"red",3,"click"]],template:function(i,r){i&1&&(a(0,"nav")(1,"a",0),l(2,"Home"),c(),a(3,"a",1),l(4,"Books"),c(),a(5,"a",2),l(6,"Administration"),c(),a(7,"div",3),L(8,st,2,0,"button",4)(9,at,2,0,"button",5),a(10,"button",6),T("click",function(){return r.requestSubscription()}),l(11,"!"),c()()(),a(12,"main"),W(13,"router-outlet"),c()),i&2&&(u(8),d("ngIf",!r.auth.isAuthenticated),u(),d("ngIf",r.auth.isAuthenticated),u(),B("green",r.permission==="granted")("red",r.permission==="denied"),d("disabled",!r.permission))},dependencies:[$,Fe,N,Ue]})};var X=class t{constructor(e){this.authService=e}intercept(e,i){let r="1234567890";if(this.authService.isAuthenticated){let n=e.clone({setHeaders:{Authorization:`Bearer ${r}`}});return i.handle(n)}else return i.handle(e)}static \u0275fac=function(i){return new(i||t)(f(O))};static \u0275prov=E({token:t,factory:t.\u0275fac})};var ee=class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=A({type:t,bootstrap:[Q]});static \u0275inj=y({providers:[{provide:Re,useClass:X,multi:!0}],imports:[xe,z,Le,We.register("ngsw-worker.js",{enabled:!Oe(),registrationStrategy:"registerWhenStable:30000"})]})};je().bootstrapModule(ee,{ngZoneEventCoalescing:!0}).catch(t=>console.error(t));

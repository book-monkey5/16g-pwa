import{a as O}from"./chunk-E7BT4X6M.js";import{A as E,Aa as $,B as C,Ba as ke,C as me,D as h,E as z,Ea as ee,F as I,Fa as Te,G as k,Ga as Ae,Ha as _e,Ia as Oe,J as he,Ja as Me,L as N,La as Pe,M as D,Ma as H,Na as _,O as de,Oa as Ne,Pa as te,Qa as De,R as J,T as m,U as T,X as fe,_ as R,a as re,aa as d,ba as W,c as V,ca as c,da as p,e as ne,ea as B,f as U,g as oe,h as v,ha as L,i as se,ia as A,j as Z,ja as Q,ka as ge,l as G,la as l,m as Y,ma as ve,n as y,na as be,o as g,p as ae,q as ce,qa as we,r as b,ra as Ee,s as pe,sa as Se,t as le,u as ue,v as w,va as ye,wa as X,x as P,xa as Ce,za as Ie}from"./chunk-E6E3DMNJ.js";var x="Service workers are disabled or not supported by this browser";function Ye(t){return Z(()=>oe(new Error(t)))}var M=class{constructor(e){if(this.serviceWorker=e,!e)this.worker=this.events=this.registration=Ye(x);else{let i=G(e,"controllerchange").pipe(v(()=>e.controller)),r=Z(()=>U(e.controller)),n=se(r,i);this.worker=n.pipe(g(f=>!!f)),this.registration=this.worker.pipe(w(()=>e.getRegistration()));let F=G(e,"message").pipe(v(f=>f.data)).pipe(g(f=>f&&f.type)).pipe(ue());F.connect(),this.events=F}}postMessage(e,o){return this.worker.pipe(b(1),P(i=>{i.postMessage(re({action:e},o))})).toPromise().then(()=>{})}postMessageWithOperation(e,o,i){let r=this.waitForOperationCompleted(i),n=this.postMessage(e,o);return Promise.all([n,r]).then(([,s])=>s)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(e){let o;return typeof e=="string"?o=i=>i.type===e:o=i=>e.includes(i.type),this.events.pipe(g(o))}nextEventOfType(e){return this.eventsOfType(e).pipe(b(1))}waitForOperationCompleted(e){return this.eventsOfType("OPERATION_COMPLETED").pipe(g(o=>o.nonce===e),b(1),v(o=>{if(o.result!==void 0)return o.result;throw new Error(o.error)})).toPromise()}get isEnabled(){return!!this.serviceWorker}},q=(()=>{let e=class e{get isEnabled(){return this.sw.isEnabled}constructor(i){if(this.sw=i,this.pushManager=null,this.subscriptionChanges=new V,!i.isEnabled){this.messages=y,this.notificationClicks=y,this.subscription=y;return}this.messages=this.sw.eventsOfType("PUSH").pipe(v(n=>n.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(v(n=>n.data)),this.pushManager=this.sw.registration.pipe(v(n=>n.pushManager));let r=this.pushManager.pipe(w(n=>n.getSubscription()));this.subscription=Y(r,this.subscriptionChanges)}requestSubscription(i){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(x));let r={userVisibleOnly:!0},n=this.decodeBase64(i.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),s=new Uint8Array(new ArrayBuffer(n.length));for(let a=0;a<n.length;a++)s[a]=n.charCodeAt(a);return r.applicationServerKey=s,this.pushManager.pipe(w(a=>a.subscribe(r)),b(1)).toPromise().then(a=>(this.subscriptionChanges.next(a),a))}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(x));let i=r=>{if(r===null)throw new Error("Not subscribed to push notifications.");return r.unsubscribe().then(n=>{if(!n)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})};return this.subscription.pipe(b(1),w(i)).toPromise()}decodeBase64(i){return atob(i)}};e.\u0275fac=function(r){return new(r||e)(h(M))},e.\u0275prov=E({token:e,factory:e.\u0275fac});let t=e;return t})(),K=(()=>{let e=class e{get isEnabled(){return this.sw.isEnabled}constructor(i){if(this.sw=i,!i.isEnabled){this.versionUpdates=y,this.unrecoverable=y;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(x));let i=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:i},i)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(x));let i=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:i},i)}};e.\u0275fac=function(r){return new(r||e)(h(M))},e.\u0275prov=E({token:e,factory:e.\u0275fac});let t=e;return t})();var Re=new me("");function ze(t,e,o,i){return()=>{if(!(ee(i)&&"serviceWorker"in navigator&&o.enabled!==!1))return;let r=t.get(fe),n=t.get(X);r.runOutsideAngular(()=>{let a=navigator.serviceWorker,u=()=>a.controller?.postMessage({action:"INITIALIZE"});a.addEventListener("controllerchange",u),n.onDestroy(()=>{a.removeEventListener("controllerchange",u)})});let s;if(typeof o.registrationStrategy=="function")s=o.registrationStrategy();else{let[a,...u]=(o.registrationStrategy||"registerWhenStable:30000").split(":");switch(a){case"registerImmediately":s=U(null);break;case"registerWithDelay":s=Le(+u[0]||0);break;case"registerWhenStable":s=u[0]?Y(je(t),Le(+u[0])):je(t);break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${o.registrationStrategy}`)}}r.runOutsideAngular(()=>s.pipe(b(1)).subscribe(()=>navigator.serviceWorker.register(e,{scope:o.scope}).catch(a=>console.error("Service worker registration failed with:",a))))}}function Le(t){return U(null).pipe(pe(t))}function je(t){return t.get(X).isStable.pipe(g(o=>o))}function Je(t,e){return new M(ee(e)&&t.enabled!==!1?navigator.serviceWorker:void 0)}var j=class{};function Qe(t,e={}){return he([q,K,{provide:Re,useValue:t},{provide:j,useValue:e},{provide:M,useFactory:Je,deps:[j,J]},{provide:ye,useFactory:ze,deps:[de,Re,j,J],multi:!0}])}var xe=(()=>{let e=class e{static register(i,r={}){return{ngModule:e,providers:[Qe(i,r)]}}};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=k({type:e}),e.\u0275inj=C({providers:[q,K]});let t=e;return t})();var et=t=>["/books",t];function tt(t,e){if(t&1&&(c(0,"li")(1,"a",6),l(2),c(3,"p",7),l(4),p()()()),t&2){let o=e.$implicit;m(),d("routerLink",we(3,et,o.isbn)),m(),be(" ",o.title," "),m(2),ve(o.subtitle)}}function it(t,e){t&1&&(c(0,"li"),l(1,"No results"),p())}function rt(t,e){if(t&1&&(c(0,"ul",3),R(1,tt,5,5,"li",4)(2,it,2,0,"li",5),p()),t&2){let o=e.ngIf;m(),d("ngForOf",o),m(),d("ngIf",!o.length)}}var Ve=(()=>{let e=class e{constructor(i){this.service=i,this.input$=new V,this.isLoading=!1,this.results$=this.input$.pipe(g(r=>r.length>=3),ce(500),le(),P(()=>this.isLoading=!0),w(r=>this.service.getAllSearch(r)),P(()=>this.isLoading=!1))}};e.\u0275fac=function(r){return new(r||e)(T(De))},e.\u0275cmp=I({type:e,selectors:[["bm-search"]],decls:4,vars:5,consts:[["searchInput",""],["type","search","autocomplete","off","aria-label","Search",3,"input"],["class","search-results",4,"ngIf"],[1,"search-results"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"routerLink"],["role","doc-subtitle"]],template:function(r,n){if(r&1){let s=L();c(0,"input",1,0),A("input",function(){N(s);let u=ge(1);return D(n.input$.next(u.value))}),p(),R(2,rt,3,2,"ul",2),Ee(3,"async")}r&2&&(W("loading",n.isLoading),m(2),d("ngIf",Se(3,3,n.results$)))},dependencies:[Ie,$,_,ke]});let t=e;return t})();var Ue=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=I({type:e,selectors:[["bm-home"]],decls:7,vars:0,consts:[["routerLink","/books",1,"button","red"]],template:function(r,n){r&1&&(c(0,"h1"),l(1,"Home"),p(),c(2,"a",0),l(3,` Show book list
`),p(),c(4,"h2"),l(5,"Search"),p(),B(6,"bm-search"))},dependencies:[_,Ve]});let t=e;return t})();var We=()=>{let t=z(O),e=z(H);return t.isAuthenticated?!0:(window.alert("Not logged in!"),e.parseUrl("/home"))};var ot=[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",component:Ue},{path:"books",loadChildren:()=>import("./chunk-I7FBB4W5.js").then(t=>t.BooksModule)},{path:"admin",loadChildren:()=>import("./chunk-2VUI53OK.js").then(t=>t.AdminModule),canActivate:[We]}],Be=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=k({type:e}),e.\u0275inj=C({imports:[te.forRoot(ot),te]});let t=e;return t})();var $e=(()=>{let e=class e{constructor(i,r,n){this.http=i,this.swPush=r,this.router=n,this.VAPID_PUBLIC_KEY="BGk2Rx3DEjXdRv9qP8aKrypFoNjISAZ54l-3V05xpPOV-5ZQJvVH9OB9Rz5Ug7H_qH6CEr40f4Pi3DpjzYLbfCA",this.baseUrl="https://api5.angular-buch.com/notifications",this.swPush.notificationClicks.subscribe(s=>{let a=s.notification.data;a?.book?.isbn&&this.router.navigate(["/books",a.book.isbn])})}get isEnabled(){return this.swPush.isEnabled}requestSubscription(){let i=this.swPush.requestSubscription({serverPublicKey:this.VAPID_PUBLIC_KEY});return ne(i).pipe(ae(r=>this.registerOnServer(r)))}registerOnServer(i){return this.http.post(this.baseUrl,i)}};e.\u0275fac=function(r){return new(r||e)(h(Te),h(q),h(H))},e.\u0275prov=E({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function ct(t,e){if(t&1){let o=L();c(0,"button",7),A("click",function(){N(o);let r=Q();return D(r.auth.login())}),l(1,"Login"),p()}}function pt(t,e){if(t&1){let o=L();c(0,"button",8),A("click",function(){N(o);let r=Q();return D(r.auth.logout())}),l(1,"Logout"),p()}}var He=(()=>{let e=class e{constructor(i,r,n){this.auth=i,this.swUpdate=r,this.notificationService=n,this.swUpdate.versionUpdates.subscribe(s=>{switch(s.type){case"VERSION_DETECTED":{console.log("Downloading new app version:",s.version.appData);break}case"VERSION_READY":{let a=s.currentVersion.appData,u=s.latestVersion.appData,F=a.version,f=u.version,Ze=u.changelog,Ge=`Update from ${F} to ${f}. Changes: ${Ze}. Install?`;window.confirm(Ge)&&window.location.reload();break}case"VERSION_INSTALLATION_FAILED":{console.log(`Failed to install ${s.version.appData}:`,s.error);break}}}),this.notificationService.isEnabled&&this.setPermission()}setPermission(){"Notification"in window&&(this.permission=Notification.permission)}requestSubscription(){this.notificationService.requestSubscription().subscribe(()=>this.setPermission())}};e.\u0275fac=function(r){return new(r||e)(T(O),T(K),T($e))},e.\u0275cmp=I({type:e,selectors:[["bm-root"]],decls:14,vars:7,consts:[["routerLink","/home","routerLinkActive","active","ariaCurrentWhenActive","page"],["routerLink","/books","routerLinkActive","active","ariaCurrentWhenActive","page"],["routerLink","/admin","routerLinkActive","active","ariaCurrentWhenActive","page"],[1,"actions"],["class","green",3,"click",4,"ngIf"],["class","red",3,"click",4,"ngIf"],["aria-label","Notifications",3,"click","disabled"],[1,"green",3,"click"],[1,"red",3,"click"]],template:function(r,n){r&1&&(c(0,"nav")(1,"a",0),l(2,"Home"),p(),c(3,"a",1),l(4,"Books"),p(),c(5,"a",2),l(6,"Administration"),p(),c(7,"div",3),R(8,ct,2,0,"button",4)(9,pt,2,0,"button",5),c(10,"button",6),A("click",function(){return n.requestSubscription()}),l(11,"!"),p()()(),c(12,"main"),B(13,"router-outlet"),p()),r&2&&(m(8),d("ngIf",!n.auth.isAuthenticated),m(),d("ngIf",n.auth.isAuthenticated),m(),W("green",n.permission==="granted")("red",n.permission==="denied"),d("disabled",!n.permission))},dependencies:[$,Pe,_,Ne]});let t=e;return t})();var qe=(()=>{let e=class e{constructor(i){this.authService=i}intercept(i,r){let n="1234567890";if(this.authService.isAuthenticated){let s=i.clone({setHeaders:{Authorization:`Bearer ${n}`}});return r.handle(s)}else return r.handle(i)}};e.\u0275fac=function(r){return new(r||e)(h(O))},e.\u0275prov=E({token:e,factory:e.\u0275fac});let t=e;return t})();var Ke=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=k({type:e,bootstrap:[He]}),e.\u0275inj=C({providers:[{provide:Ae,useClass:qe,multi:!0}],imports:[Me,Be,_e,xe.register("ngsw-worker.js",{enabled:!Ce(),registrationStrategy:"registerWhenStable:30000"})]});let t=e;return t})();Oe().bootstrapModule(Ke,{ngZoneEventCoalescing:!0}).catch(t=>console.error(t));

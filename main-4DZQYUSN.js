import{a as P}from"./chunk-QLRTYBL2.js";import{$ as L,A as E,B as I,C as we,Ca as Oe,D as f,Da as $,E as ne,Ea as Me,F as k,G as y,Ha as ce,Ia as De,J as Se,Ja as Re,Ka as Le,L as D,La as je,M as R,Ma as xe,O as Ee,Oa as Fe,Pa as q,Q as Ce,Qa as N,Ra as Ue,S as oe,Sa as pe,Ta as Ve,U as l,V as A,a as ue,ba as d,c as U,ca as W,da as s,e as V,ea as a,f as H,fa as B,g as me,h as v,i as fe,ia as j,j as te,ja as T,ka as se,l as ie,la as _e,m as re,ma as c,n as _,na as Ie,o as b,oa as ke,p as de,q as he,r as w,ra as ye,s as ge,sa as Ae,t as ve,ta as Te,u as be,v as S,wa as Ne,x as M,xa as ae,ya as Pe}from"./chunk-J2PZFT3L.js";var F="Service workers are disabled or not supported by this browser";function Ze(t){return te(()=>me(new Error(t)))}var O=class{constructor(i){if(this.serviceWorker=i,!i)this.worker=this.events=this.registration=Ze(F);else{let r=ie(i,"controllerchange").pipe(v(()=>i.controller)),n=te(()=>H(i.controller)),p=fe(n,r);this.worker=p.pipe(b(h=>!!h)),this.registration=this.worker.pipe(S(()=>i.getRegistration()));let g=ie(i,"message").pipe(v(h=>h.data)).pipe(b(h=>h&&h.type)).pipe(be());g.connect(),this.events=g}}postMessage(i,e){return this.worker.pipe(w(1),M(r=>{r.postMessage(ue({action:i},e))})).toPromise().then(()=>{})}postMessageWithOperation(i,e,r){let n=this.waitForOperationCompleted(r),p=this.postMessage(i,e);return Promise.all([p,n]).then(([,o])=>o)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(i){let e;return typeof i=="string"?e=r=>r.type===i:e=r=>i.includes(r.type),this.events.pipe(b(e))}nextEventOfType(i){return this.eventsOfType(i).pipe(w(1))}waitForOperationCompleted(i){return this.eventsOfType("OPERATION_COMPLETED").pipe(b(e=>e.nonce===i),w(1),v(e=>{if(e.result!==void 0)return e.result;throw new Error(e.error)})).toPromise()}get isEnabled(){return!!this.serviceWorker}},K=(()=>{class t{get isEnabled(){return this.sw.isEnabled}constructor(e){if(this.sw=e,this.pushManager=null,this.subscriptionChanges=new U,!e.isEnabled){this.messages=_,this.notificationClicks=_,this.subscription=_;return}this.messages=this.sw.eventsOfType("PUSH").pipe(v(n=>n.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(v(n=>n.data)),this.pushManager=this.sw.registration.pipe(v(n=>n.pushManager));let r=this.pushManager.pipe(S(n=>n.getSubscription()));this.subscription=re(r,this.subscriptionChanges)}requestSubscription(e){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(F));let r={userVisibleOnly:!0},n=this.decodeBase64(e.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),p=new Uint8Array(new ArrayBuffer(n.length));for(let o=0;o<n.length;o++)p[o]=n.charCodeAt(o);return r.applicationServerKey=p,this.pushManager.pipe(S(o=>o.subscribe(r)),w(1)).toPromise().then(o=>(this.subscriptionChanges.next(o),o))}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(F));let e=r=>{if(r===null)throw new Error("Not subscribed to push notifications.");return r.unsubscribe().then(n=>{if(!n)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})};return this.subscription.pipe(w(1),S(e)).toPromise()}decodeBase64(e){return atob(e)}static{this.\u0275fac=function(r){return new(r||t)(f(O))}}static{this.\u0275prov=E({token:t,factory:t.\u0275fac})}}return t})(),Z=(()=>{class t{get isEnabled(){return this.sw.isEnabled}constructor(e){if(this.sw=e,!e.isEnabled){this.versionUpdates=_,this.unrecoverable=_;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(F));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:e},e)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(F));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:e},e)}static{this.\u0275fac=function(r){return new(r||t)(f(O))}}static{this.\u0275prov=E({token:t,factory:t.\u0275fac})}}return t})();var He=new we("");function Ge(t,i,e,r){return()=>{if(!(ce(r)&&"serviceWorker"in navigator&&e.enabled!==!1))return;let n=t.get(Ce),p=t.get(ae);n.runOutsideAngular(()=>{let u=navigator.serviceWorker,m=()=>u.controller?.postMessage({action:"INITIALIZE"});u.addEventListener("controllerchange",m),p.onDestroy(()=>{u.removeEventListener("controllerchange",m)})});let o;if(typeof e.registrationStrategy=="function")o=e.registrationStrategy();else{let[u,...m]=(e.registrationStrategy||"registerWhenStable:30000").split(":");switch(u){case"registerImmediately":o=H(null);break;case"registerWithDelay":o=We(+m[0]||0);break;case"registerWhenStable":let g=V(t.get(ae).whenStable());o=m[0]?re(g,We(+m[0])):g;break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${e.registrationStrategy}`)}}n.runOutsideAngular(()=>o.pipe(w(1)).subscribe(()=>navigator.serviceWorker.register(i,{scope:e.scope}).catch(u=>console.error("Service worker registration failed with:",u))))}}function We(t){return H(null).pipe(ge(t))}function Ye(t,i){return new O(ce(i)&&t.enabled!==!1?navigator.serviceWorker:void 0)}var x=class{};function ze(t,i={}){return Se([K,Z,{provide:He,useValue:t},{provide:x,useValue:i},{provide:O,useFactory:Ye,deps:[x,oe]},{provide:Ne,useFactory:Ge,deps:[Ee,He,x,oe],multi:!0}])}var Be=(()=>{class t{static register(e,r={}){return{ngModule:t,providers:[ze(e,r)]}}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=y({type:t})}static{this.\u0275inj=I({providers:[K,Z]})}}return t})();var Qe=t=>["/books",t];function Xe(t,i){if(t&1&&(s(0,"li")(1,"a",6),c(2),s(3,"p",7),c(4),a()()()),t&2){let e=i.$implicit;l(),d("routerLink",ye(3,Qe,e.isbn)),l(),ke(" ",e.title," "),l(2),Ie(e.subtitle)}}function et(t,i){t&1&&(s(0,"li"),c(1,"No results"),a())}function tt(t,i){if(t&1&&(s(0,"ul",3),L(1,Xe,5,5,"li",4)(2,et,2,0,"li",5),a()),t&2){let e=i.ngIf;l(),d("ngForOf",e),l(),d("ngIf",!e.length)}}var G=class t{constructor(i){this.service=i;this.results$=this.input$.pipe(b(e=>e.length>=3),he(500),ve(),M(()=>this.isLoading=!0),S(e=>this.service.getAllSearch(e)),M(()=>this.isLoading=!1))}input$=new U;isLoading=!1;results$;static \u0275fac=function(e){return new(e||t)(A(Ve))};static \u0275cmp=k({type:t,selectors:[["bm-search"]],decls:4,vars:5,consts:[["searchInput",""],["type","search","autocomplete","off","aria-label","Search",3,"input"],["class","search-results",4,"ngIf"],[1,"search-results"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"routerLink"],["role","doc-subtitle"]],template:function(e,r){if(e&1){let n=j();s(0,"input",1,0),T("input",function(){D(n);let o=_e(1);return R(r.input$.next(o.value))}),a(),L(2,tt,3,2,"ul",2),Ae(3,"async")}e&2&&(W("loading",r.isLoading),l(2),d("ngIf",Te(3,3,r.results$)))},dependencies:[Oe,$,N,Me]})};var Y=class t{static \u0275fac=function(e){return new(e||t)};static \u0275cmp=k({type:t,selectors:[["bm-home"]],decls:7,vars:0,consts:[["routerLink","/books",1,"button","red"]],template:function(e,r){e&1&&(s(0,"h1"),c(1,"Home"),a(),s(2,"a",0),c(3,` Show book list
`),a(),s(4,"h2"),c(5,"Search"),a(),B(6,"bm-search"))},dependencies:[N,G]})};var Ke=()=>{let t=ne(P),i=ne(q);return t.isAuthenticated?!0:(window.alert("Not logged in!"),i.parseUrl("/home"))};var rt=[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",component:Y},{path:"books",loadChildren:()=>import("./chunk-HYXGKQPZ.js").then(t=>t.BooksModule)},{path:"admin",loadChildren:()=>import("./chunk-AMKU53ZM.js").then(t=>t.AdminModule),canActivate:[Ke]}],z=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=y({type:t});static \u0275inj=I({imports:[pe.forRoot(rt),pe]})};var J=class t{constructor(i,e,r){this.http=i;this.swPush=e;this.router=r;this.swPush.notificationClicks.subscribe(n=>{let p=n.notification.data;p?.book?.isbn&&this.router.navigate(["/books",p.book.isbn])})}VAPID_PUBLIC_KEY="BGk2Rx3DEjXdRv9qP8aKrypFoNjISAZ54l-3V05xpPOV-5ZQJvVH9OB9Rz5Ug7H_qH6CEr40f4Pi3DpjzYLbfCA";baseUrl="https://api5.angular-buch.com/notifications";get isEnabled(){return this.swPush.isEnabled}requestSubscription(){let i=this.swPush.requestSubscription({serverPublicKey:this.VAPID_PUBLIC_KEY});return V(i).pipe(de(e=>this.registerOnServer(e)))}registerOnServer(i){return this.http.post(this.baseUrl,i)}static \u0275fac=function(e){return new(e||t)(f(De),f(K),f(q))};static \u0275prov=E({token:t,factory:t.\u0275fac,providedIn:"root"})};function st(t,i){if(t&1){let e=j();s(0,"button",7),T("click",function(){D(e);let n=se();return R(n.auth.login())}),c(1,"Login"),a()}}function at(t,i){if(t&1){let e=j();s(0,"button",8),T("click",function(){D(e);let n=se();return R(n.auth.logout())}),c(1,"Logout"),a()}}var Q=class t{constructor(i,e,r){this.auth=i;this.swUpdate=e;this.notificationService=r;this.swUpdate.versionUpdates.subscribe(n=>{switch(n.type){case"VERSION_DETECTED":{console.log("Downloading new app version:",n.version.appData);break}case"VERSION_READY":{let p=n.currentVersion.appData,o=n.latestVersion.appData,u=p.version,m=o.version,g=o.changelog,h=`Update from ${u} to ${m}. Changes: ${g}. Install?`;window.confirm(h)&&window.location.reload();break}case"VERSION_INSTALLATION_FAILED":{console.log(`Failed to install ${n.version.appData}:`,n.error);break}}}),this.notificationService.isEnabled&&this.setPermission()}permission;setPermission(){"Notification"in window&&(this.permission=Notification.permission)}requestSubscription(){this.notificationService.requestSubscription().subscribe(()=>this.setPermission())}static \u0275fac=function(e){return new(e||t)(A(P),A(Z),A(J))};static \u0275cmp=k({type:t,selectors:[["bm-root"]],decls:14,vars:7,consts:[["routerLink","/home","routerLinkActive","active","ariaCurrentWhenActive","page"],["routerLink","/books","routerLinkActive","active","ariaCurrentWhenActive","page"],["routerLink","/admin","routerLinkActive","active","ariaCurrentWhenActive","page"],[1,"actions"],["class","green",3,"click",4,"ngIf"],["class","red",3,"click",4,"ngIf"],["aria-label","Notifications",3,"click","disabled"],[1,"green",3,"click"],[1,"red",3,"click"]],template:function(e,r){e&1&&(s(0,"nav")(1,"a",0),c(2,"Home"),a(),s(3,"a",1),c(4,"Books"),a(),s(5,"a",2),c(6,"Administration"),a(),s(7,"div",3),L(8,st,2,0,"button",4)(9,at,2,0,"button",5),s(10,"button",6),T("click",function(){return r.requestSubscription()}),c(11,"!"),a()()(),s(12,"main"),B(13,"router-outlet"),a()),e&2&&(l(8),d("ngIf",!r.auth.isAuthenticated),l(),d("ngIf",r.auth.isAuthenticated),l(),W("green",r.permission==="granted")("red",r.permission==="denied"),d("disabled",!r.permission))},dependencies:[$,Fe,N,Ue]})};var X=class t{constructor(i){this.authService=i}intercept(i,e){let r="1234567890";if(this.authService.isAuthenticated){let n=i.clone({setHeaders:{Authorization:`Bearer ${r}`}});return e.handle(n)}else return e.handle(i)}static \u0275fac=function(e){return new(e||t)(f(P))};static \u0275prov=E({token:t,factory:t.\u0275fac})};var ee=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=y({type:t,bootstrap:[Q]});static \u0275inj=I({providers:[{provide:Re,useClass:X,multi:!0}],imports:[xe,z,Le,Be.register("ngsw-worker.js",{enabled:!Pe(),registrationStrategy:"registerWhenStable:30000"})]})};je().bootstrapModule(ee,{ngZoneEventCoalescing:!0}).catch(t=>console.error(t));

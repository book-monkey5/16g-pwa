import{a as M}from"./chunk-OUM7I4SI.js";import{$ as D,A as E,B as y,C as me,Ca as Ie,D as d,Da as H,E as z,Ea as _e,F as I,G as _,Ha as ee,Ia as ke,J as de,Ja as Ae,Ka as Te,L as N,La as Me,M as R,Ma as Oe,O as fe,Oa as Pe,Pa as $,Qa as T,R as J,Ra as Ne,Sa as te,T as u,Ta as Re,U as k,X as he,a as re,ba as f,c as V,ca as W,da as a,e as ne,ea as p,f as U,fa as B,g as oe,h as v,i as se,ia as L,j as Z,ja as A,ka as Q,l as G,la as ge,m as Y,ma as l,n as C,na as ve,o as g,oa as be,p as ae,q as ce,r as b,ra as we,s as pe,sa as Ee,t as le,ta as Se,u as ue,v as w,wa as Ce,x as P,xa as X,ya as ye}from"./chunk-UZOWJZPK.js";var x="Service workers are disabled or not supported by this browser";function Ge(e){return Z(()=>oe(new Error(e)))}var O=class{constructor(i){if(this.serviceWorker=i,!i)this.worker=this.events=this.registration=Ge(x);else{let t=G(i,"controllerchange").pipe(v(()=>i.controller)),n=Z(()=>U(i.controller)),o=se(n,t);this.worker=o.pipe(g(h=>!!h)),this.registration=this.worker.pipe(w(()=>i.getRegistration()));let F=G(i,"message").pipe(v(h=>h.data)).pipe(g(h=>h&&h.type)).pipe(ue());F.connect(),this.events=F}}postMessage(i,r){return this.worker.pipe(b(1),P(t=>{t.postMessage(re({action:i},r))})).toPromise().then(()=>{})}postMessageWithOperation(i,r,t){let n=this.waitForOperationCompleted(t),o=this.postMessage(i,r);return Promise.all([o,n]).then(([,c])=>c)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(i){let r;return typeof i=="string"?r=t=>t.type===i:r=t=>i.includes(t.type),this.events.pipe(g(r))}nextEventOfType(i){return this.eventsOfType(i).pipe(b(1))}waitForOperationCompleted(i){return this.eventsOfType("OPERATION_COMPLETED").pipe(g(r=>r.nonce===i),b(1),v(r=>{if(r.result!==void 0)return r.result;throw new Error(r.error)})).toPromise()}get isEnabled(){return!!this.serviceWorker}},q=(()=>{let i=class i{get isEnabled(){return this.sw.isEnabled}constructor(t){if(this.sw=t,this.pushManager=null,this.subscriptionChanges=new V,!t.isEnabled){this.messages=C,this.notificationClicks=C,this.subscription=C;return}this.messages=this.sw.eventsOfType("PUSH").pipe(v(o=>o.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(v(o=>o.data)),this.pushManager=this.sw.registration.pipe(v(o=>o.pushManager));let n=this.pushManager.pipe(w(o=>o.getSubscription()));this.subscription=Y(n,this.subscriptionChanges)}requestSubscription(t){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(x));let n={userVisibleOnly:!0},o=this.decodeBase64(t.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),c=new Uint8Array(new ArrayBuffer(o.length));for(let s=0;s<o.length;s++)c[s]=o.charCodeAt(s);return n.applicationServerKey=c,this.pushManager.pipe(w(s=>s.subscribe(n)),b(1)).toPromise().then(s=>(this.subscriptionChanges.next(s),s))}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(x));let t=n=>{if(n===null)throw new Error("Not subscribed to push notifications.");return n.unsubscribe().then(o=>{if(!o)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})};return this.subscription.pipe(b(1),w(t)).toPromise()}decodeBase64(t){return atob(t)}};i.\u0275fac=function(n){return new(n||i)(d(O))},i.\u0275prov=E({token:i,factory:i.\u0275fac});let e=i;return e})(),K=(()=>{let i=class i{get isEnabled(){return this.sw.isEnabled}constructor(t){if(this.sw=t,!t.isEnabled){this.versionUpdates=C,this.unrecoverable=C;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(x));let t=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:t},t)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(x));let t=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:t},t)}};i.\u0275fac=function(n){return new(n||i)(d(O))},i.\u0275prov=E({token:i,factory:i.\u0275fac});let e=i;return e})();var De=new me("");function Ye(e,i,r,t){return()=>{if(!(ee(t)&&"serviceWorker"in navigator&&r.enabled!==!1))return;let n=e.get(he),o=e.get(X);n.runOutsideAngular(()=>{let s=navigator.serviceWorker,m=()=>s.controller?.postMessage({action:"INITIALIZE"});s.addEventListener("controllerchange",m),o.onDestroy(()=>{s.removeEventListener("controllerchange",m)})});let c;if(typeof r.registrationStrategy=="function")c=r.registrationStrategy();else{let[s,...m]=(r.registrationStrategy||"registerWhenStable:30000").split(":");switch(s){case"registerImmediately":c=U(null);break;case"registerWithDelay":c=Le(+m[0]||0);break;case"registerWhenStable":c=m[0]?Y(je(e),Le(+m[0])):je(e);break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${r.registrationStrategy}`)}}n.runOutsideAngular(()=>c.pipe(b(1)).subscribe(()=>navigator.serviceWorker.register(i,{scope:r.scope}).catch(s=>console.error("Service worker registration failed with:",s))))}}function Le(e){return U(null).pipe(pe(e))}function je(e){return e.get(X).isStable.pipe(g(r=>r))}function ze(e,i){return new O(ee(i)&&e.enabled!==!1?navigator.serviceWorker:void 0)}var j=class{};function Je(e,i={}){return de([q,K,{provide:De,useValue:e},{provide:j,useValue:i},{provide:O,useFactory:ze,deps:[j,J]},{provide:Ce,useFactory:Ye,deps:[fe,De,j,J],multi:!0}])}var xe=(()=>{let i=class i{static register(t,n={}){return{ngModule:i,providers:[Je(t,n)]}}};i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=_({type:i}),i.\u0275inj=y({providers:[q,K]});let e=i;return e})();var Xe=e=>["/books",e];function et(e,i){if(e&1&&(a(0,"li")(1,"a",6),l(2),a(3,"p",7),l(4),p()()()),e&2){let r=i.$implicit;u(),f("routerLink",we(3,Xe,r.isbn)),u(),be(" ",r.title," "),u(2),ve(r.subtitle)}}function tt(e,i){e&1&&(a(0,"li"),l(1,"No results"),p())}function it(e,i){if(e&1&&(a(0,"ul",3),D(1,et,5,5,"li",4)(2,tt,2,0,"li",5),p()),e&2){let r=i.ngIf;u(),f("ngForOf",r),u(),f("ngIf",!r.length)}}var Ve=(()=>{class e{service;input$=new V;isLoading=!1;results$;constructor(r){this.service=r,this.results$=this.input$.pipe(g(t=>t.length>=3),ce(500),le(),P(()=>this.isLoading=!0),w(t=>this.service.getAllSearch(t)),P(()=>this.isLoading=!1))}static \u0275fac=function(t){return new(t||e)(k(Re))};static \u0275cmp=I({type:e,selectors:[["bm-search"]],decls:4,vars:5,consts:[["searchInput",""],["type","search","autocomplete","off","aria-label","Search",3,"input"],["class","search-results",4,"ngIf"],[1,"search-results"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"routerLink"],["role","doc-subtitle"]],template:function(t,n){if(t&1){let o=L();a(0,"input",1,0),A("input",function(){N(o);let s=ge(1);return R(n.input$.next(s.value))}),p(),D(2,it,3,2,"ul",2),Ee(3,"async")}t&2&&(W("loading",n.isLoading),u(2),f("ngIf",Se(3,3,n.results$)))},dependencies:[Ie,H,T,_e]})}return e})();var Ue=(()=>{class e{static \u0275fac=function(t){return new(t||e)};static \u0275cmp=I({type:e,selectors:[["bm-home"]],decls:7,vars:0,consts:[["routerLink","/books",1,"button","red"]],template:function(t,n){t&1&&(a(0,"h1"),l(1,"Home"),p(),a(2,"a",0),l(3,` Show book list
`),p(),a(4,"h2"),l(5,"Search"),p(),B(6,"bm-search"))},dependencies:[T,Ve]})}return e})();var We=()=>{let e=z(M),i=z($);return e.isAuthenticated?!0:(window.alert("Not logged in!"),i.parseUrl("/home"))};var nt=[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",component:Ue},{path:"books",loadChildren:()=>import("./chunk-UYFSIOAA.js").then(e=>e.BooksModule)},{path:"admin",loadChildren:()=>import("./chunk-7XFUBETA.js").then(e=>e.AdminModule),canActivate:[We]}],Be=(()=>{class e{static \u0275fac=function(t){return new(t||e)};static \u0275mod=_({type:e});static \u0275inj=y({imports:[te.forRoot(nt),te]})}return e})();var He=(()=>{class e{http;swPush;router;VAPID_PUBLIC_KEY="BGk2Rx3DEjXdRv9qP8aKrypFoNjISAZ54l-3V05xpPOV-5ZQJvVH9OB9Rz5Ug7H_qH6CEr40f4Pi3DpjzYLbfCA";baseUrl="https://api5.angular-buch.com/notifications";constructor(r,t,n){this.http=r,this.swPush=t,this.router=n,this.swPush.notificationClicks.subscribe(o=>{let c=o.notification.data;c?.book?.isbn&&this.router.navigate(["/books",c.book.isbn])})}get isEnabled(){return this.swPush.isEnabled}requestSubscription(){let r=this.swPush.requestSubscription({serverPublicKey:this.VAPID_PUBLIC_KEY});return ne(r).pipe(ae(t=>this.registerOnServer(t)))}registerOnServer(r){return this.http.post(this.baseUrl,r)}static \u0275fac=function(t){return new(t||e)(d(ke),d(q),d($))};static \u0275prov=E({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function at(e,i){if(e&1){let r=L();a(0,"button",7),A("click",function(){N(r);let n=Q();return R(n.auth.login())}),l(1,"Login"),p()}}function ct(e,i){if(e&1){let r=L();a(0,"button",8),A("click",function(){N(r);let n=Q();return R(n.auth.logout())}),l(1,"Logout"),p()}}var $e=(()=>{class e{auth;swUpdate;notificationService;permission;constructor(r,t,n){this.auth=r,this.swUpdate=t,this.notificationService=n,this.swUpdate.versionUpdates.subscribe(o=>{switch(o.type){case"VERSION_DETECTED":{console.log("Downloading new app version:",o.version.appData);break}case"VERSION_READY":{let c=o.currentVersion.appData,s=o.latestVersion.appData,m=c.version,F=s.version,h=s.changelog,Ze=`Update from ${m} to ${F}. Changes: ${h}. Install?`;window.confirm(Ze)&&window.location.reload();break}case"VERSION_INSTALLATION_FAILED":{console.log(`Failed to install ${o.version.appData}:`,o.error);break}}}),this.notificationService.isEnabled&&this.setPermission()}setPermission(){"Notification"in window&&(this.permission=Notification.permission)}requestSubscription(){this.notificationService.requestSubscription().subscribe(()=>this.setPermission())}static \u0275fac=function(t){return new(t||e)(k(M),k(K),k(He))};static \u0275cmp=I({type:e,selectors:[["bm-root"]],decls:14,vars:7,consts:[["routerLink","/home","routerLinkActive","active","ariaCurrentWhenActive","page"],["routerLink","/books","routerLinkActive","active","ariaCurrentWhenActive","page"],["routerLink","/admin","routerLinkActive","active","ariaCurrentWhenActive","page"],[1,"actions"],["class","green",3,"click",4,"ngIf"],["class","red",3,"click",4,"ngIf"],["aria-label","Notifications",3,"click","disabled"],[1,"green",3,"click"],[1,"red",3,"click"]],template:function(t,n){t&1&&(a(0,"nav")(1,"a",0),l(2,"Home"),p(),a(3,"a",1),l(4,"Books"),p(),a(5,"a",2),l(6,"Administration"),p(),a(7,"div",3),D(8,at,2,0,"button",4)(9,ct,2,0,"button",5),a(10,"button",6),A("click",function(){return n.requestSubscription()}),l(11,"!"),p()()(),a(12,"main"),B(13,"router-outlet"),p()),t&2&&(u(8),f("ngIf",!n.auth.isAuthenticated),u(),f("ngIf",n.auth.isAuthenticated),u(),W("green",n.permission==="granted")("red",n.permission==="denied"),f("disabled",!n.permission))},dependencies:[H,Pe,T,Ne]})}return e})();var qe=(()=>{class e{authService;constructor(r){this.authService=r}intercept(r,t){let n="1234567890";if(this.authService.isAuthenticated){let o=r.clone({setHeaders:{Authorization:`Bearer ${n}`}});return t.handle(o)}else return t.handle(r)}static \u0275fac=function(t){return new(t||e)(d(M))};static \u0275prov=E({token:e,factory:e.\u0275fac})}return e})();var Ke=(()=>{class e{static \u0275fac=function(t){return new(t||e)};static \u0275mod=_({type:e,bootstrap:[$e]});static \u0275inj=y({providers:[{provide:Ae,useClass:qe,multi:!0}],imports:[Oe,Be,Te,xe.register("ngsw-worker.js",{enabled:!ye(),registrationStrategy:"registerWhenStable:30000"})]})}return e})();Me().bootstrapModule(Ke,{ngZoneEventCoalescing:!0}).catch(e=>console.error(e));

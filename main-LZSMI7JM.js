import{a as T}from"./chunk-WE5KFNW2.js";import{A as w,B as C,Ba as Ne,C as ve,Ca as $,D as m,Da as Me,E as ne,F as be,Ga as Oe,H as P,Ha as Pe,I as D,Ia as De,Ja as Re,K as we,Ka as Le,La as je,M as Se,Na as xe,Oa as q,Pa as A,Q as l,Qa as Fe,Ra as ae,Sa as Ue,T as k,V as y,W as I,_ as R,a as pe,aa as Ee,ba as oe,c as U,da as f,e as V,ea as W,f as H,fa as s,g as le,ga as c,h,ha as B,i as ue,j as te,ka as L,l as re,la as _,m as ie,ma as se,n as E,na as Ce,o as g,oa as p,p as me,pa as ke,q as fe,qa as ye,r as v,s as de,t as he,ta as Ie,u as ge,ua as _e,v as b,va as Ae,x as O,xa as Te}from"./chunk-F6DL7SAO.js";var x="Service workers are disabled or not supported by this browser";function Ke(t){return te(()=>le(new Error(t)))}var N=class{serviceWorker;worker;registration;events;constructor(r){if(this.serviceWorker=r,!r)this.worker=this.events=this.registration=Ke(x);else{let i=re(r,"controllerchange").pipe(h(()=>r.controller)),n=te(()=>H(r.controller)),a=ue(n,i);this.worker=a.pipe(g(d=>!!d)),this.registration=this.worker.pipe(b(()=>r.getRegistration()));let F=re(r,"message").pipe(h(d=>d.data)).pipe(g(d=>d&&d.type)).pipe(ge());F.connect(),this.events=F}}postMessage(r,e){return this.worker.pipe(v(1),O(i=>{i.postMessage(pe({action:r},e))})).toPromise().then(()=>{})}postMessageWithOperation(r,e,i){let n=this.waitForOperationCompleted(i),a=this.postMessage(r,e);return Promise.all([a,n]).then(([,o])=>o)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(r){let e;return typeof r=="string"?e=i=>i.type===r:e=i=>r.includes(i.type),this.events.pipe(g(e))}nextEventOfType(r){return this.eventsOfType(r).pipe(v(1))}waitForOperationCompleted(r){return this.eventsOfType("OPERATION_COMPLETED").pipe(g(e=>e.nonce===r),v(1),h(e=>{if(e.result!==void 0)return e.result;throw new Error(e.error)})).toPromise()}get isEnabled(){return!!this.serviceWorker}},K=(()=>{class t{sw;messages;notificationClicks;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new U;constructor(e){if(this.sw=e,!e.isEnabled){this.messages=E,this.notificationClicks=E,this.subscription=E;return}this.messages=this.sw.eventsOfType("PUSH").pipe(h(n=>n.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(h(n=>n.data)),this.pushManager=this.sw.registration.pipe(h(n=>n.pushManager));let i=this.pushManager.pipe(b(n=>n.getSubscription()));this.subscription=ie(i,this.subscriptionChanges)}requestSubscription(e){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(x));let i={userVisibleOnly:!0},n=this.decodeBase64(e.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),a=new Uint8Array(new ArrayBuffer(n.length));for(let o=0;o<n.length;o++)a[o]=n.charCodeAt(o);return i.applicationServerKey=a,this.pushManager.pipe(b(o=>o.subscribe(i)),v(1)).toPromise().then(o=>(this.subscriptionChanges.next(o),o))}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(x));let e=i=>{if(i===null)throw new Error("Not subscribed to push notifications.");return i.unsubscribe().then(n=>{if(!n)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})};return this.subscription.pipe(v(1),b(e)).toPromise()}decodeBase64(e){return atob(e)}static \u0275fac=function(i){return new(i||t)(m(N))};static \u0275prov=w({token:t,factory:t.\u0275fac})}return t})(),Z=(()=>{class t{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}constructor(e){if(this.sw=e,!e.isEnabled){this.versionUpdates=E,this.unrecoverable=E;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(x));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:e},e)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(x));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:e},e)}static \u0275fac=function(i){return new(i||t)(m(N))};static \u0275prov=w({token:t,factory:t.\u0275fac})}return t})();var Ve=new ve("");function Ze(t,r,e){return()=>{if(!("serviceWorker"in navigator&&e.enabled!==!1))return;let i=t.get(Se),n=t.get(oe);i.runOutsideAngular(()=>{let o=navigator.serviceWorker,u=()=>o.controller?.postMessage({action:"INITIALIZE"});o.addEventListener("controllerchange",u),n.onDestroy(()=>{o.removeEventListener("controllerchange",u)})});let a;if(typeof e.registrationStrategy=="function")a=e.registrationStrategy();else{let[o,...u]=(e.registrationStrategy||"registerWhenStable:30000").split(":");switch(o){case"registerImmediately":a=H(null);break;case"registerWithDelay":a=He(+u[0]||0);break;case"registerWhenStable":let M=V(t.get(oe).whenStable());a=u[0]?ie(M,He(+u[0])):M;break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${e.registrationStrategy}`)}}i.runOutsideAngular(()=>a.pipe(v(1)).subscribe(()=>navigator.serviceWorker.register(r,{scope:e.scope}).catch(o=>console.error("Service worker registration failed with:",o))))}}function He(t){return H(null).pipe(de(t))}function Ge(t){return new N(t.enabled!==!1?navigator.serviceWorker:void 0)}var j=class{enabled;scope;registrationStrategy};function Ye(t,r={}){return be([K,Z,{provide:Ve,useValue:t},{provide:j,useValue:r},{provide:N,useFactory:Ge,deps:[j]},{provide:Ee,useFactory:Ze,deps:[we,Ve,j],multi:!0}])}var We=(()=>{class t{static register(e,i={}){return{ngModule:t,providers:[Ye(e,i)]}}static \u0275fac=function(i){return new(i||t)};static \u0275mod=I({type:t});static \u0275inj=C({providers:[K,Z]})}return t})();var Je=t=>["/books",t];function Qe(t,r){if(t&1&&(s(0,"li")(1,"a",6),p(2),s(3,"p",7),p(4),c()()()),t&2){let e=r.$implicit;l(),f("routerLink",Ie(3,Je,e.isbn)),l(),ye(" ",e.title," "),l(2),ke(e.subtitle)}}function Xe(t,r){t&1&&(s(0,"li"),p(1,"No results"),c())}function et(t,r){if(t&1&&(s(0,"ul",3),R(1,Qe,5,5,"li",4)(2,Xe,2,0,"li",5),c()),t&2){let e=r.ngIf;l(),f("ngForOf",e),l(),f("ngIf",!e.length)}}var G=class t{constructor(r){this.service=r;this.results$=this.input$.pipe(g(e=>e.length>=3),fe(500),he(),O(()=>this.isLoading=!0),b(e=>this.service.getAllSearch(e)),O(()=>this.isLoading=!1))}input$=new U;isLoading=!1;results$;static \u0275fac=function(e){return new(e||t)(k(Ue))};static \u0275cmp=y({type:t,selectors:[["bm-search"]],standalone:!1,decls:4,vars:5,consts:[["searchInput",""],["type","search","autocomplete","off","aria-label","Search",3,"input"],["class","search-results",4,"ngIf"],[1,"search-results"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"routerLink"],["role","doc-subtitle"]],template:function(e,i){if(e&1){let n=L();s(0,"input",1,0),_("input",function(){P(n);let o=Ce(1);return D(i.input$.next(o.value))}),c(),R(2,et,3,2,"ul",2),_e(3,"async")}e&2&&(W("loading",i.isLoading),l(2),f("ngIf",Ae(3,3,i.results$)))},dependencies:[Ne,$,A,Me],encapsulation:2})};var Y=class t{static \u0275fac=function(e){return new(e||t)};static \u0275cmp=y({type:t,selectors:[["bm-home"]],standalone:!1,decls:7,vars:0,consts:[["routerLink","/books",1,"button","red"]],template:function(e,i){e&1&&(s(0,"h1"),p(1,"Home"),c(),s(2,"a",0),p(3,` Show book list
`),c(),s(4,"h2"),p(5,"Search"),c(),B(6,"bm-search"))},dependencies:[A,G],encapsulation:2})};var qe=()=>{let t=ne(T),r=ne(q);return t.isAuthenticated?!0:(window.alert("Not logged in!"),r.parseUrl("/home"))};var rt=[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",component:Y},{path:"books",loadChildren:()=>import("./chunk-O6LKO2AZ.js").then(t=>t.BooksModule)},{path:"admin",loadChildren:()=>import("./chunk-PFE64CZU.js").then(t=>t.AdminModule),canActivate:[qe]}],z=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=I({type:t});static \u0275inj=C({imports:[ae.forRoot(rt),ae]})};var J=class t{constructor(r,e,i){this.http=r;this.swPush=e;this.router=i;this.swPush.notificationClicks.subscribe(n=>{let a=n.notification.data;a?.book?.isbn&&this.router.navigate(["/books",a.book.isbn])})}VAPID_PUBLIC_KEY="BGk2Rx3DEjXdRv9qP8aKrypFoNjISAZ54l-3V05xpPOV-5ZQJvVH9OB9Rz5Ug7H_qH6CEr40f4Pi3DpjzYLbfCA";baseUrl="https://api5.angular-buch.com/notifications";get isEnabled(){return this.swPush.isEnabled}requestSubscription(){let r=this.swPush.requestSubscription({serverPublicKey:this.VAPID_PUBLIC_KEY});return V(r).pipe(me(e=>this.registerOnServer(e)))}registerOnServer(r){return this.http.post(this.baseUrl,r)}static \u0275fac=function(e){return new(e||t)(m(Oe),m(K),m(q))};static \u0275prov=w({token:t,factory:t.\u0275fac,providedIn:"root"})};function ot(t,r){if(t&1){let e=L();s(0,"button",7),_("click",function(){P(e);let n=se();return D(n.auth.login())}),p(1,"Login"),c()}}function st(t,r){if(t&1){let e=L();s(0,"button",8),_("click",function(){P(e);let n=se();return D(n.auth.logout())}),p(1,"Logout"),c()}}var Q=class t{constructor(r,e,i){this.auth=r;this.swUpdate=e;this.notificationService=i;this.swUpdate.versionUpdates.subscribe(n=>{switch(n.type){case"VERSION_DETECTED":{console.log("Downloading new app version:",n.version.appData);break}case"VERSION_READY":{let a=n.currentVersion.appData,o=n.latestVersion.appData,u=a.version,M=o.version,F=o.changelog,d=`Update from ${u} to ${M}. Changes: ${F}. Install?`;window.confirm(d)&&window.location.reload();break}case"VERSION_INSTALLATION_FAILED":{console.log(`Failed to install ${n.version.appData}:`,n.error);break}}}),this.notificationService.isEnabled&&this.setPermission()}permission;setPermission(){"Notification"in window&&(this.permission=Notification.permission)}requestSubscription(){this.notificationService.requestSubscription().subscribe(()=>this.setPermission())}static \u0275fac=function(e){return new(e||t)(k(T),k(Z),k(J))};static \u0275cmp=y({type:t,selectors:[["bm-root"]],standalone:!1,decls:14,vars:7,consts:[["routerLink","/home","routerLinkActive","active","ariaCurrentWhenActive","page"],["routerLink","/books","routerLinkActive","active","ariaCurrentWhenActive","page"],["routerLink","/admin","routerLinkActive","active","ariaCurrentWhenActive","page"],[1,"actions"],["class","green",3,"click",4,"ngIf"],["class","red",3,"click",4,"ngIf"],["aria-label","Notifications",3,"click","disabled"],[1,"green",3,"click"],[1,"red",3,"click"]],template:function(e,i){e&1&&(s(0,"nav")(1,"a",0),p(2,"Home"),c(),s(3,"a",1),p(4,"Books"),c(),s(5,"a",2),p(6,"Administration"),c(),s(7,"div",3),R(8,ot,2,0,"button",4)(9,st,2,0,"button",5),s(10,"button",6),_("click",function(){return i.requestSubscription()}),p(11,"!"),c()()(),s(12,"main"),B(13,"router-outlet"),c()),e&2&&(l(8),f("ngIf",!i.auth.isAuthenticated),l(),f("ngIf",i.auth.isAuthenticated),l(),W("green",i.permission==="granted")("red",i.permission==="denied"),f("disabled",!i.permission))},dependencies:[$,xe,A,Fe],encapsulation:2})};var X=class t{constructor(r){this.authService=r}intercept(r,e){let i="1234567890";if(this.authService.isAuthenticated){let n=r.clone({setHeaders:{Authorization:`Bearer ${i}`}});return e.handle(n)}else return e.handle(r)}static \u0275fac=function(e){return new(e||t)(m(T))};static \u0275prov=w({token:t,factory:t.\u0275fac})};var ee=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=I({type:t,bootstrap:[Q]});static \u0275inj=C({providers:[De(Re()),{provide:Pe,useClass:X,multi:!0}],imports:[je,z,We.register("ngsw-worker.js",{enabled:!Te(),registrationStrategy:"registerWhenStable:30000"})]})};Le().bootstrapModule(ee,{ngZoneEventCoalescing:!0}).catch(t=>console.error(t));
